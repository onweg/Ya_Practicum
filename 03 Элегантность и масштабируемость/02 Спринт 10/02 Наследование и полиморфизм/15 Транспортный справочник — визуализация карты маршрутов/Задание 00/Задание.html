<!DOCTYPE html>
<html>
<head>
  <title>Задание</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta charset="utf-8">
<style>body{font-family:Helvetica,arial,sans-serif;font-size:14px;line-height:1.6;background-color:#fff;padding:30px;color:#333;max-width:1140px;margin:0 auto}body > :first-child{margin-top:0!important}body > :last-child{margin-bottom:0!important}a{color:#4183C4;text-decoration:none}a.absent{color:#c00}a.anchor{display:block;padding-left:30px;margin-left:-30px;cursor:pointer;position:absolute;top:0;left:0;bottom:0}h1,h2,h3,h4,h5,h6{margin:20px 0 10px;padding:0;font-weight:700;-webkit-font-smoothing:antialiased;cursor:text;position:relative}h2:first-child,h1:first-child,h1:first-child + h2,h3:first-child,h4:first-child,h5:first-child,h6:first-child{margin-top:0;padding-top:0}h1:hover a.anchor,h2:hover a.anchor,h3:hover a.anchor,h4:hover a.anchor,h5:hover a.anchor,h6:hover a.anchor{text-decoration:none}h1 tt,h1 code{font-size:inherit}h2 tt,h2 code{font-size:inherit}h3 tt,h3 code{font-size:inherit}h4 tt,h4 code{font-size:inherit}h5 tt,h5 code{font-size:inherit}h6 tt,h6 code{font-size:inherit}h1{font-size:28px;color:#000}h2{font-size:24px;border-bottom:1px solid #ccc;color:#000}h3{font-size:18px}h4{font-size:16px}h5{font-size:14px}h6{color:#777;font-size:14px}p,blockquote,ul,ol,dl,li,table,pre{margin:15px 0}hr {padding:0;margin-bottom:-8px;height:1px;border:none;background:black}body > h2:first-child{margin-top:0;padding-top:0}body > h1:first-child{margin-top:0;padding-top:0}body > h1:first-child + h2{margin-top:0;padding-top:0}body > h3:first-child,body > h4:first-child,body > h5:first-child,body > h6:first-child{margin-top:0;padding-top:0}a:first-child h1,a:first-child h2,a:first-child h3,a:first-child h4,a:first-child h5,a:first-child h6{margin-top:0;padding-top:0}h1 p,h2 p,h3 p,h4 p,h5 p,h6 p{margin-top:0}li p.first{display:inline-block}ul,ol{padding-left:30px}ul :first-child,ol :first-child{margin-top:0}ul :last-child,ol :last-child{margin-bottom:0}dl{padding:0}dl dt{font-size:14px;font-weight:700;font-style:italic;padding:0;margin:15px 0 5px}dl dt:first-child{padding:0}dl dt > :first-child{margin-top:0}dl dt > :last-child{margin-bottom:0}dl dd{margin:0 0 15px;padding:0 15px}dl dd > :first-child{margin-top:0}dl dd > :last-child{margin-bottom:0}blockquote{border-left:4px solid #ddd;padding:0 15px;color:#777}blockquote > :first-child{margin-top:0}blockquote > :last-child{margin-bottom:0}table{padding:0}table tr{border-top:1px solid #ccc;background-color:#fff;margin:0;padding:0}table tr:nth-child(2n){background-color:#f8f8f8}table tr th{font-weight:700;border:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}table tr td{border:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}table tr th :first-child,table tr td :first-child{margin-top:0}table tr th :last-child,table tr td :last-child{margin-bottom:0}img{max-width:100%;display:block}span.frame{display:block;overflow:hidden}span.frame > span{border:1px solid #ddd;display:block;float:left;overflow:hidden;margin:13px 0 0;padding:7px;width:auto}span.frame span img{display:block;float:left}span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}span.align-center{display:block;overflow:hidden;clear:both}span.align-center > span{display:block;overflow:hidden;margin:13px auto 0;text-align:center}span.align-center span img{margin:0 auto;text-align:center}span.align-right{display:block;overflow:hidden;clear:both}span.align-right > span{display:block;overflow:hidden;margin:13px 0 0;text-align:right}span.align-right span img{margin:0;text-align:right}span.float-left{display:block;margin-right:13px;overflow:hidden;float:left}span.float-left span{margin:13px 0 0}span.float-right{display:block;margin-left:13px;overflow:hidden;float:right}span.float-right > span{display:block;overflow:hidden;margin:13px auto 0;text-align:right}code,tt{margin:0 2px;padding:0 5px;white-space:nowrap;border:1px solid #eaeaea;background-color:#f8f8f8;border-radius:3px}pre code{margin:0;padding:0;white-space:pre;border:none;background:transparent}.highlight pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}pre code,pre tt{background-color:transparent;border:none}.slasher{color:#000000}</style></head>
<body>

<h3>Задание 1. Визуализация линий маршрутов</h3>

<p>Примените свою библиотеку SVG, чтобы вывести в stdout карту с линиями маршрутов.</p>

<h3>Входные данные</h3>

<p>Чтобы управлять визуализацией карты, во входном JSON-документе появляется словарь <code>render_settings</code>.</p>

<pre><code class="language-json">{
  &quot;base_requests&quot;: [ ... ],
  &quot;render_settings&quot;: { ... },
  &quot;stat_requests&quot;: [ ... ]
}
</code></pre>

<p>Структура словаря <code>render_settings</code>:</p>

<pre><code class="language-json">{
  &quot;width&quot;: 1200.0,
  &quot;height&quot;: 1200.0,

  &quot;padding&quot;: 50.0,

  &quot;line_width&quot;: 14.0,
  &quot;stop_radius&quot;: 5.0,

  &quot;bus_label_font_size&quot;: 20,
  &quot;bus_label_offset&quot;: [7.0, 15.0],

  &quot;stop_label_font_size&quot;: 20,
  &quot;stop_label_offset&quot;: [7.0, -3.0],

  &quot;underlayer_color&quot;: [255, 255, 255, 0.85],
  &quot;underlayer_width&quot;: 3.0,

  &quot;color_palette&quot;: [
    &quot;green&quot;,
    [255, 160, 0],
    &quot;red&quot;
  ]
}
</code></pre>

<ul>
<li><code>width</code> и <code>height</code> — ширина и высота изображения в пикселях. Вещественное число в диапазоне от 0 до 100000.</li>
<li><code>padding</code> — отступ краёв карты от границ SVG-документа. Вещественное число не меньше 0 и меньше <code>min(width, height)/2</code>.</li>
<li><code>line_width</code> — толщина линий, которыми рисуются автобусные маршруты. Вещественное число в диапазоне от 0 до 100000.</li>
<li><code>stop_radius</code> — радиус окружностей, которыми обозначаются остановки. Вещественное число в диапазоне от 0 до 100000.</li>
<li><code>bus_label_font_size</code> — размер текста, которым написаны названия автобусных маршрутов. Целое число в диапазоне от 0 до 100000.</li>
<li><code>bus_label_offset</code> — смещение надписи с названием маршрута относительно координат конечной остановки на карте. Массив из двух элементов типа <code>double</code>. Задаёт значения свойств <code>dx</code> и <code>dy</code> SVG-элемента <code>&lt;text&gt;</code>. Элементы массива — числа в диапазоне от –100000 до 100000.</li>
<li><code>stop_label_font_size</code> — размер текста, которым отображаются названия остановок. Целое число в диапазоне от 0 до 100000.</li>
<li><code>stop_label_offset</code> — смещение названия остановки относительно её координат на карте. Массив из двух элементов типа <code>double</code>. Задаёт значения свойств <code>dx</code> и <code>dy</code> SVG-элемента <code>&lt;text&gt;</code>. Числа в диапазоне от –100000 до 100000.</li>
<li><code>underlayer_color</code> — цвет подложки под названиями остановок и маршрутов. Формат хранения цвета будет ниже.</li>
<li><code>underlayer_width</code> — толщина подложки под названиями остановок и маршрутов. Задаёт значение атрибута <code>stroke-width</code> элемента <code>&lt;text&gt;</code>. Вещественное число в диапазоне от 0 до 100000.</li>
<li><code>color_palette</code> — цветовая палитра. Непустой массив.</li>
</ul>

<p>Цвет можно указать в одном из следующих форматов:</p>

<ul>
<li>в виде строки, например, <code>&quot;red&quot;</code> или <code>&quot;black&quot;</code>;</li>
<li>в массиве из трёх целых чисел диапазона [0, 255]. Они определяют <code>r</code>, <code>g</code> и <code>b</code> компоненты цвета в формате <code>svg::Rgb</code>. Цвет <code>[255, 16, 12]</code> нужно вывести в SVG как <code>rgb(255,16,12)</code>;</li>
<li>в массиве из четырёх элементов: три целых числа в диапазоне от [0, 255] и одно вещественное число в диапазоне от [0.0, 1.0]. Они задают составляющие <code>red</code>, <code>green</code>, <code>blue</code> и <code>opacity</code> цвета формата <code>svg::Rgba</code>. Цвет, заданный как <code>[255, 200, 23, 0.85]</code>, должен быть выведен в SVG как <code>rgba(255,200,23,0.85)</code>.</li>
</ul>

<p>Гарантируется, что каждый цвет задан в одном из этих трёх форматов.</p>

<h3>Выходные данные</h3>

<p>В stdout программа должна вывести SVG-изображение карты. Обрабатывать содержимое ключа <code>stat_requests</code> и выводить JSON с ответами на запросы к транспортному справочнику не нужно.</p>

<h3>Пример входных данных</h3>

<p>Этот JSON документ содержит описание пяти остановок и двух маршрутов, а также настройки, управляющие визуализацией карты. Алгоритм рисования карты будет рассматривается на примере этого документа.</p>

<p>🔗 input.json</p>

<h3>Определение цвета маршрута</h3>

<p>Из палитры <code>color_palette</code> выбираются цвета линий в соответствии с лексикографическим порядком названий маршрутов: первый по алфавиту маршрут должен получить первый цвет, второй маршрут — второй цвет и так далее. Если маршрутов больше, чем цветов в палитре, цвета переиспользуются по циклу. Например, когда маршрутов десять, а цветов три, первый цвет будет у первого, четвёртого, седьмого и десятого маршрута.</p>

<p>Если на маршруте нет остановок, следующий за ним маршрут должен использовать в палитре тот же индекс. Допустим, маршрутов десять, и у четвёртого остановок нет. Цветов в палитре три. Тогда первый цвет получат первый, пятый и восьмой автобусы.</p>

<p>В приведённом JSON-документе объявлены два маршрута: “14” и “114”. В лексикографическом порядке строка “114” предшествует “14”, поэтому маршрут “114” будет иметь цвет <code>green</code>, а “14” — <code>rgb(255,160,0)</code> (оттенок оранжевого цвета).</p>

<h3>Отрисовка линий маршрутов</h3>

<p>Линии маршрутов должны выводиться в виде ломаной линии, соединяющей остановки. Порядок рисования: по возрастанию названий маршрутов. Линии маршрутов, на которых нет остановок, рисоваться не должны.</p>

<p>Свойства линий:</p>

<ul>
<li>цвет линии <code>stroke</code> определён по правилам выше;</li>
<li>цвет заливки <code>fill</code> должен иметь значение <code>none</code>;</li>
<li>толщина линии <code>stroke-width</code> равна настройке <code>line_width</code>;</li>
<li>Формы конца линии <code>stroke-linecap</code> и соединений <code>stroke-linejoin</code> равны <code>round</code>.</li>
</ul>

<p>Вершины каждой ломаной — это координаты соответствующих остановок. Выведите их в порядке следования <strong>от первой до первой остановки по кольцевому маршруту</strong>. Для проецирования координат остановок на SVG-карту используйте класс <code>SphereProjector</code>. Количество вершин должно быть равно величине <code>stop_count</code> из ответа на запрос <code>Bus</code>. Если маршрут некольцевой, то есть <code>&quot;is_roundtrip&quot;: false</code>, каждый отрезок между соседними остановками должен быть нарисован дважды: сначала в прямом, а потом в обратном направлении.</p>

<p>Для JSON из примера сначала зелёным цветом рисуется маршрут “114”. Он некольцевой, поэтому его тег <code>&lt;polyline&gt;</code> задаёт ломаную линию из трёх узлов: начальная остановка “Morskoy vokzal” с координатами (99.2283, 329.5), затем конечная “Riviersiy most” с координатами (50, 232.18) и снова начальная “Morskoy vokzal”.</p>

<p>Вторым выводится маршрут “14” оранжевого цвета. Он кольцевой, поэтому тег <code>&lt;polyline&gt;</code> начинается в остановке “Ulitsa Lizy Chaikinoi”, проходит через “Elektroseti” и “Ulitsa Dokuchaeva” и возвращается в “Ulitsa Lizy Chaikinoi”.</p>

<p>Ожидаемый вывод программы для JSON документа из примера:</p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;&gt;
  &lt;polyline points=&quot;99.2283,329.5 50,232.18 99.2283,329.5&quot; fill=&quot;none&quot; stroke=&quot;green&quot; stroke-width=&quot;14&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;/&gt;
  &lt;polyline points=&quot;550,190.051 279.22,50 333.61,269.08 550,190.051&quot; fill=&quot;none&quot; stroke=&quot;rgb(255,160,0)&quot; stroke-width=&quot;14&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;/&gt;
&lt;/svg&gt;
</code></pre>

<p>Если сохранить вывод программы в файл и открыть в браузере, вы увидите такую карту маршрутов:</p>

<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiID8+DQo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSItNTAgLTUwIDcwMCA1MDAiPg0KICA8cG9seWxpbmUgcG9pbnRzPSI5OS4yMjgzLDMyOS41IDUwLDIzMi4xOCA5OS4yMjgzLDMyOS41IiBmaWxsPSJub25lIiBzdHJva2U9ImdyZWVuIiBzdHJva2Utd2lkdGg9IjE0IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4NCiAgPHBvbHlsaW5lIHBvaW50cz0iNTUwLDE5MC4wNTEgMjc5LjIyLDUwIDMzMy42MSwyNjkuMDggNTUwLDE5MC4wNTEiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiKDI1NSwxNjAsMCkiIHN0cm9rZS13aWR0aD0iMTQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPg0KPC9zdmc+" alt="image" />
<em>Маршруты “114” (зелёный) и “14” (оранжевый)</em></p>

<h3>Как будет тестироваться ваш код</h3>

<p>Тренажёр подаст на stdin программы валидный JSON документ и сравнит выведенное в stdout SVG-изображение с ожидаемым по тем же принципам, что и в задачах по разработке SVG-библиотеки.</p>

<p>Гарантируется, что названия маршрутов и остановок в JSON будут содержать только цифры, буквы английского алфавита и пробелы.</p>

<p>Чтобы ваш код прошёл тесты, соблюдайте порядок отрисовки и алгоритм проекции остановок на плоскую карту.</p>

<h3>Подсказка</h3>

<ol>
<li>Создайте в модуле <code>map_renderer</code> структуру, которая хранит настройки визуализации карты, и инициализируйте её значениями прямо в коде. Так вы сосредоточитесь на рисовании карты и не будете отвлекаться на чтение настроек из JSON. Вы сможете сделать это позже, когда реализуете визуализацию линий маршрутов.</li>
<li>Воспользуйтесь классом <code>SphereProjector</code> из теории, чтобы корректно проецировать координаты земной поверхности в координаты на карте.</li>
<li>Соблюдайте указанный в условии порядок рисования линий маршрутов и вершин ломаных линий. Иначе тренажёр будет считать результат визуализации некорректным.</li>
</ol>

</body>
</html>
